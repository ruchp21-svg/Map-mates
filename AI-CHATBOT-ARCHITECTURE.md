# ğŸ¤– AI Chatbot - Visual Architecture & Overview

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MapMates Frontend                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚                                      â”‚
â”‚  React Components            â”‚     Services & APIs                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Navbar Component     â”‚  â”‚  â”‚  openaiService.js            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ’¬ AI Chat Link  â”‚  â”‚  â”‚  â”‚  â”‚ sendMessageToOpenAI()  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â”‚ getRecommendations()   â”‚  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚ getTrendingMeetups()   â”‚  â”‚   â”‚
â”‚            â†“                 â”‚  â”‚  â”‚ helpCreateEvent()      â”‚  â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚ answerQuestion()       â”‚  â”‚   â”‚
â”‚  â”‚ AIChatbot (Widget)     â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”‚                              â”‚   â”‚
â”‚  â”‚ â”‚ ğŸ’¬ Floating Btn  â”‚   â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  â”‚  â”‚  â”‚ chatHistoryService.js  â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ Message Display  â”‚   â”‚  â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  â”‚  â”‚  â”‚ â”‚ saveChatMessage()  â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ Input Box        â”‚   â”‚  â”‚  â”‚  â”‚ â”‚ getChatHistory()   â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ Quick Actions    â”‚   â”‚  â”‚  â”‚  â”‚ â”‚ clearHistory()     â”‚  â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  â”‚  â”‚ â”‚ getPreferences()   â”‚  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚            â†“                 â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                                â”‚   â”‚
â”‚  â”‚ AIChatbotPage (Full)   â”‚  â”‚  â”‚                                â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”‚                                â”‚   â”‚
â”‚  â”‚ â”‚ Header           â”‚   â”‚  â”‚  â”‚                                â”‚   â”‚
â”‚  â”‚ â”‚ Settings Panel   â”‚   â”‚  â”‚  â”‚                                â”‚   â”‚
â”‚  â”‚ â”‚ Messages Area    â”‚   â”‚  â”‚  â”‚                                â”‚   â”‚
â”‚  â”‚ â”‚ Input Area       â”‚   â”‚  â”‚  â”‚                                â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  â”‚                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                                â”‚   â”‚
â”‚                              â”‚  â”‚                                â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   OpenAI API Server   â”‚
                    â”‚  (GPT-3.5-turbo)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Firebase Firestore   â”‚
                    â”‚  (Chat History)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Tree

```
App
â”œâ”€â”€ Router
â”‚   â””â”€â”€ Routes
â”‚       â”œâ”€â”€ /ai-chat â†’ AIChatbotPage
â”‚       â”‚   â”œâ”€â”€ Header (Navigation)
â”‚       â”‚   â”œâ”€â”€ Settings Panel
â”‚       â”‚   â”œâ”€â”€ Messages Container
â”‚       â”‚   â””â”€â”€ Input Area
â”‚       â””â”€â”€ ... (other routes)
â”‚
â””â”€â”€ AIChatbot (Floating Widget)
    â”œâ”€â”€ Chat Button (ğŸ’¬)
    â”œâ”€â”€ Chat Window
    â”‚   â”œâ”€â”€ Header
    â”‚   â”œâ”€â”€ Messages Container
    â”‚   â”œâ”€â”€ Message Input
    â”‚   â””â”€â”€ Quick Actions
    â””â”€â”€ Notification Badge
```

---

## Data Flow

### User Sends Message
```
User Input
    â†“
[AIChatbot Component]
    â†“
Save to Firestore â† [saveChatMessage()]
    â†“
Send to OpenAI â† [sendMessageToOpenAI()]
    â†“
[OpenAI API]
    â†“
Receive Response
    â†“
Display in UI
    â†“
Save Response â† [saveChatMessage()]
    â†“
Update State & Render
```

### Loading Chat History
```
User Opens Chat
    â†“
[Load Preferences] â† [getChatbotPreferences()]
    â†“
[Load Messages] â† [getChatHistory()]
    â†“
Firestore Query
    â†“
Render Messages
    â†“
Display UI
```

### Quick Actions
```
User Clicks Action
    â†“
Generate Prompt
    â†“
Set Input Value
    â†“
Trigger Send
    â†“
Follow Message Flow
```

---

## User Interface Layouts

### Desktop - Floating Widget
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Page Content               â”‚
â”‚                                             â”‚
â”‚                                             â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                          â”‚ AI Assistant â”‚   â”‚
â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚                          â”‚ Hello there! â”‚   â”‚
â”‚                          â”‚              â”‚   â”‚
â”‚                          â”‚  Hi! How can â”‚   â”‚
â”‚                          â”‚  I help?     â”‚   â”‚
â”‚                          â”‚              â”‚   â”‚
â”‚                          â”‚ [Input box]  â”‚   â”‚
â”‚                          â”‚ [Send Btn]   â”‚   â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     ğŸ’¬ (minimized)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Desktop - Full Page
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† MapMates AI Assistant                    âš™ï¸ ğŸ—‘ï¸  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  ğŸ¤–  Welcome! How can I help?                    â”‚
â”‚                                                  â”‚
â”‚                                                  â”‚
â”‚                       You: Recommend events  â”˜   â”‚
â”‚                                                  â”‚
â”‚  ğŸ¤–  Here are 5 great options:              â”˜    â”‚
â”‚      1. Mountain Photography...                  â”‚
â”‚      2. Beach Cleanup Meetup...                  â”‚
â”‚                                                  â”‚
â”‚  [Recommend Events] [Create Event]              â”‚
â”‚  [Trending Meetups] [App Help]                  â”‚
â”‚                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Input Field          ] [â¤]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Mobile - Floating Widget
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Assistant         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Hello! I'm here      â”‚
â”‚ to help you find     â”‚
â”‚ amazing events.      â”‚
â”‚                      â”‚
â”‚ What can I do?       â”‚
â”‚                      â”‚
â”‚ [Recommend Events] â”˜ â”‚
â”‚ [Trending]       â”˜   â”‚
â”‚ [Create Event]   â”˜   â”‚
â”‚                      â”‚
â”‚ [Type message    ] â‡’ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Clear history        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¬ â† Minimized state
```

---

## Feature Capabilities Map

```
AI Chatbot
â”‚
â”œâ”€â”€ ğŸ¯ Event Discovery
â”‚   â”œâ”€â”€ Analyze user interests
â”‚   â”œâ”€â”€ Check location
â”‚   â”œâ”€â”€ Consider budget
â”‚   â””â”€â”€ Return recommendations
â”‚
â”œâ”€â”€ â• Event Creation
â”‚   â”œâ”€â”€ Ask clarifying questions
â”‚   â”œâ”€â”€ Gather event details
â”‚   â”œâ”€â”€ Build event structure
â”‚   â””â”€â”€ Provide suggestions
â”‚
â”œâ”€â”€ â“ App Guidance
â”‚   â”œâ”€â”€ How to join trips
â”‚   â”œâ”€â”€ Using chat features
â”‚   â”œâ”€â”€ Managing profile
â”‚   â””â”€â”€ Understanding karma
â”‚
â”œâ”€â”€ ğŸ“ˆ Trending Meetups
â”‚   â”œâ”€â”€ Query popular events
â”‚   â”œâ”€â”€ Suggest nearby activities
â”‚   â”œâ”€â”€ Provide details
â”‚   â””â”€â”€ Share group info
â”‚
â””â”€â”€ ğŸ’¾ Data Management
    â”œâ”€â”€ Save chat history
    â”œâ”€â”€ Store preferences
    â”œâ”€â”€ Per-user isolation
    â””â”€â”€ Clear history option
```

---

## Message Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Types     â”‚
â”‚  "Recommend     â”‚
â”‚   events"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AIChatbot.js / AIChatbotPage.js   â”‚
â”‚   handleSendMessage()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Display User â”‚    â”‚ Save Message â”‚   â”‚ Prepare Context  â”‚
â”‚ Message      â”‚    â”‚ to Firestore â”‚   â”‚ (location, etc)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ sendMessageToOpenAI()    â”‚
                                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                                     â”‚ â”‚ Build request      â”‚   â”‚
                                     â”‚ â”‚ Include system     â”‚   â”‚
                                     â”‚ â”‚ prompt + context   â”‚   â”‚
                                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ OpenAI API Server        â”‚
                                     â”‚ Process with GPT-3.5     â”‚
                                     â”‚ Generate response        â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â–¼
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ Parse & Format Response  â”‚
                                     â”‚ Handle errors            â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                                     â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Display AI  â”‚             â”‚ Save Response to     â”‚    â”‚ Update UI    â”‚
    â”‚ Message     â”‚             â”‚ Firestore            â”‚    â”‚ State        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                               â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Show Final UI    â”‚
                          â”‚ Ready for next   â”‚
                          â”‚ message          â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management

### AIChatbot Component State
```javascript
{
  isOpen: boolean,              // Widget expanded?
  messages: Array<Message>,     // Chat history
  inputValue: string,           // User input
  isLoading: boolean,           // Loading?
  error: string | null,         // Error message
  currentUser: User,            // Logged in user
  hasNewMessage: boolean        // Notification
}
```

### AIChatbotPage Component State
```javascript
{
  messages: Array<Message>,
  inputValue: string,
  isLoading: boolean,
  error: string | null,
  showSettings: boolean,        // Settings visible?
  preferences: {
    location: string,
    interests: string,
    budget: 'budget' | 'moderate' | 'premium'
  }
}
```

---

## API Integration Points

### OpenAI API Calls
```
1. sendMessageToOpenAI(messages, location, interests)
   â”œâ”€ Endpoint: https://api.openai.com/v1/chat/completions
   â”œâ”€ Method: POST
   â”œâ”€ Model: gpt-3.5-turbo
   â”œâ”€ Max tokens: 1000
   â””â”€ Response: Assistant message

2. Error Handling:
   â”œâ”€ 401: Invalid API key
   â”œâ”€ 429: Rate limited
   â”œâ”€ 500: Server error
   â””â”€ Network: Connection error
```

### Firestore Database Calls
```
Collection: ai_chat_history
  â”œâ”€ Document: {userId}_{timestamp}_{random}
  â”œâ”€ Fields:
  â”‚  â”œâ”€ userId: string
  â”‚  â”œâ”€ role: 'user' | 'assistant'
  â”‚  â”œâ”€ content: string
  â”‚  â”œâ”€ sessionId: string
  â”‚  â”œâ”€ timestamp: serverTimestamp
  â”‚  â””â”€ createdAt: ISO string
  â”‚
  â””â”€ Queries:
     â”œâ”€ Get history: WHERE userId == X ORDER BY timestamp
     â”œâ”€ Get sessions: WHERE userId == X
     â””â”€ Delete: WHERE userId == X AND sessionId == Y

Collection: users
  â””â”€ Field: chatbotPreferences
     â”œâ”€ location: string
     â”œâ”€ interests: string
     â””â”€ budget: string
```

---

## Performance Metrics

### Load Times
- Widget rendering: <100ms
- Full page load: <200ms
- API response: 2-5 seconds
- Firestore query: <200ms

### Bundle Sizes
- JavaScript: ~35 KB (gzipped)
- CSS: ~15 KB (gzipped)
- Total: ~50 KB

### Database Queries
- Get history: O(n) where n = messages
- Save message: O(1)
- Get preferences: O(1)
- Clear history: O(n)

---

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         User Browser                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  localStorage: currentUser              â”‚
â”‚  Not stored: API keys                   â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Environment     â”‚
    â”‚ Variables       â”‚
    â”‚ (.env.local)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ React Application          â”‚
    â”‚ (Authenticated only)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ OpenAI API â—„â”€â”€â–º Firestore    â”‚
    â”‚ (Secure HTTPS)                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Integration Points

```
MapMates App
â”‚
â”œâ”€ Navbar (Updated)
â”‚  â””â”€ "ğŸ’¬ AI Chat" link â†’ /ai-chat
â”‚
â”œâ”€ App.js (Updated)
â”‚  â””â”€ /ai-chat route â†’ AIChatbotPage
â”‚
â”œâ”€ All Pages
â”‚  â””â”€ AIChatbot widget (floating)
â”‚
â”œâ”€ Firebase Auth (Existing)
â”‚  â””â”€ Used for authentication
â”‚
â””â”€ Firestore (Existing)
   â””â”€ Used for chat history
```

---

This visual architecture shows how all components work together to create the complete AI Chatbot experience! ğŸš€
